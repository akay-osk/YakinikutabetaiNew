<!DOCTYPE html>
<html lang="ja">
 <head>
   <meta charset="utf-8">
   <title>UserProfileEdit</title>
 </head>
 <body>
	
	<!--
		ファイルを読み込みするためのボタンを作成
		
		[参考資料]
		https://magazine.techacademy.jp/magazine/25655
		https://www.sejuku.net/blog/65045
	-->
		
    <form id="form1">
      <input type="file" accept=".jpg,.jpeg,.png,.gif" id="file1"/>
      <br><br>
	  <input type="submit" value="画像保存" />
    </form>
	
	<!-- 🔽 プレビュー表示エリアを追加 -->
	<div id="previewArea"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

	<script>
	
		document.getElementById('file1').addEventListener('change', function () 
		{
	    	const file = this.files[0];

	    	if (!file) return;

	    	if (!file.type.startsWith('image/')) 
			{
	      		alert('画像ファイルを選択してください。');
	      		return;
	    	}

	    	// プレビュー表示
	    	const reader = new FileReader();
	    	reader.onload = function (e) 
			{
	      		const preview = document.getElementById('previewArea');
	      		preview.innerHTML = `<img src="${e.target.result}" width="300" alt="画像プレビュー">`;
	   	 	};
	    		reader.readAsDataURL(file);
	  	});
		
		document.getElementById('form1').addEventListener('submit', async (event) => 
		{
			event.preventDefault();

			const fileInput = document.getElementById('file1');
			const file = fileInput.files[0];

			if (!file) 
			{
				alert('ファイルが選択されていません。');
				return;
			}

			/*
			const reader = new FileReader();
			reader.onload = async function(e) 
			{
				const arrayBuffer = e.target.result;
				const uint8View = new Uint8Array(arrayBuffer);
				const base64String = btoa(String.fromCharCode(...uint8View));

				// Spring BootのAPIにPOST
				const response = await fetch('/',
				{
					method: 'POST',
					headers: 
					{
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ image: base64String })
				});

				if (response.ok) 
				{
					alert('画像を保存しました！');
					
				} 
				else 
				{
					alert('保存に失敗しました。');
				}
			};

			reader.readAsArrayBuffer(file);
			*/
		});
		
	</script>
</body>