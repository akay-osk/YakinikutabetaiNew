<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="common.html :: common-head('マッチング待機中')">
</head>

<body>
<!--	<div th:replace="common.html :: header('マッチング待機中')"></div>-->

	<p>現在待機中です...<br>マッチング成立までしばらくお待ちください。</p>

	<form action="/retry" method="post" style="display:inline;">
	    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	    <button type="submit" class="btn">条件を変更する</button>
	</form>

<!--	<div th:replace="common.html :: footer"></div>-->

	<script th:inline="javascript">
		const userId = /*[[${user_id}]]*/ 0;

		function checkMatchingStatus() {
			fetch(`/check-status?userId=${userId}`)
				.then(response => response.json())
				.then(data => {
					if (data.matched && data.roomId) {
						window.location.href = `/chatroom?room_id=${data.roomId}`;
					}
				})
				.catch(error => console.error("チェック失敗:", error));
		}

		// 5秒ごとに確認
		setInterval(checkMatchingStatus, 5000);
	</script>

</body>

</html>